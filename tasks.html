<link href=https://cdn.rawgit.com/LeaVerou/prism/e262ba89ccd3cae472fde2189d91f28eb8167fc5/themes/prism-okaidia.css rel=stylesheet>
<script src=https://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.js></script>
<script src=https://cdn.rawgit.com/imakewebthings/waypoints/79903c88ed2564b6df6fb850e8430f1f68fa7f1e/lib/noframework.waypoints.min.js></script>
<style>
pre {
  white-space: pre-wrap;
  background-color: #4B2222;
}
.code-placeholder { min-height: 300px; }
.code-title {
  text-align: center;
}
.code-block {
  padding-left: 20px;
  padding-right: 20px;
}
.code-block h4 { text-align: center; }
small a { text-decoration: none; color: gray; font-size: 80%; }
</style>
<script>
$(function () {
  $(".code-placeholder").each(function () {
    new Waypoint({
      element: this,
      continuous: false,
      offset: 'bottom-in-view',
      handler: (function ($placeholder) {
        return function (dir) {
          $.ajax({
            type: 'GET',
            url: "/codeblock/{{ .Lang1 }}/{{ .Lang2 }}/" + $placeholder.data('task') + "/",
            success: function (html) {
              $placeholder.before($placeholder.find('h3'))
              var codeblock = $(html)
              $placeholder.replaceWith(codeblock)
              codeblock.find('code').each(function (_, code) {
                Prism.highlightElement(code)
              })
              var lang1 = '{{ .Lang1 }}'[0].toUpperCase() + '{{ .Lang1 }}'.substr(1)
              var lang2 = '{{ .Lang2 }}'[0].toUpperCase() + '{{ .Lang2 }}'.substr(1)
              codeblock.find('.code-lang1').prepend('<h4>' + lang1 + '</h4>')
              codeblock.find('.code-lang2').prepend('<h4>' + lang2 + '</h4>')
            },
            error: function () {
              $placeholder.remove()
              $placeholder.find('h3').remove()
            },
            complete: function () {
              if (location.hash) {
                var hash = location.hash
                location.hash = hash
              }
            }
          })
        }
      })($(this))
    })
  })

  if (location.hash.length < 2) {
    location.hash = $('.code-placeholder h3').eq(0).attr('id')
    setTimeout(function () {location.hash = ''}, 10)
  }
})
</script>

{{ range .Tasks }}
  <div class=code-placeholder data-task="{{ .Href }}">
    <h3 class=code-title id={{ .Href }}>
      <a href="#{{ .Href }}">{{ .Name }}</a>
      <small><a href="http://rosettacode.org/wiki/{{ .Href }}" target="_blank">(see task description)</a></small>
    </h3>
  </div>
{{ end }}
