<script>
$(function () {
  $(".code-placeholder").each(function () {
    new Waypoint({
      element: this,
      continuous: false,
      handler: (function ($placeholder) {
        return function (dir) {
          $.ajax({
            type: 'GET',
            url: "/codeblock/{{Lang1}}/{{Lang2}}/" + $placeholder.data('task') + "/",
            success: function (html) {
              $placeholder.before($placeholder.find('h3'))
              var codeblock = $(html)
              $placeholder.replaceWith(codeblock)
              codeblock.find('code').each(function (_, code) {
                Prism.highlightElement(code)
              })
              var lang1 = '{{Lang1}}'[0].toUpperCase() + '{{Lang1}}'.substr(1)
              var lang2 = '{{Lang2}}'[0].toUpperCase() + '{{Lang2}}'.substr(1)
              codeblock.find('.code-lang1').prepend('<h4>' + lang1 + '</h4>')
              codeblock.find('.code-lang2').prepend('<h4>' + lang2 + '</h4>')
            },
            error: function () {
              $placeholder.remove()
              $placeholder.find('h3').remove()
            },
            complete: function () {
              if (location.hash) {
                var hash = location.hash
                location.hash = hash
              }
            }
          })
        }
      })($(this))
    })
  })
})
</script>

{{#Tasks}}
  <div class=code-placeholder data-task="{{Href}}">
    <h3 class=code-title id={{Href}}><a href="#{{Href}}">{{Name}}</a></h3>
  </div>
{{/Tasks}}
